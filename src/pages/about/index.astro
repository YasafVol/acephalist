---
import { getCollection } from "astro:content"
import PageLayout from "@layouts/PageLayout.astro"
import TopLayout from "@layouts/TopLayout.astro"
import BottomLayout from "@layouts/BottomLayout.astro"
import ImageCompare from "@components/ImageCompare.astro"
import { ABOUT } from "@consts"

const [aboutContent, work] = await Promise.all([
  getCollection("about"),
  getCollection("work")
])

const aboutData = aboutContent[0]
const { Content: AboutContent } = await aboutData.render()

work.sort((a, b) => new Date(b.data.dateStart).getTime() - new Date(a.data.dateStart).getTime())

const workItems = await Promise.all(
  work.map(async (item) => {
    const { Content } = await item.render()
    return { ...item, Content }
  })
)

function formatWorkDate(input: Date | string) {
  if (typeof input === "string") return input

  const month = input.toLocaleDateString("en-US", {
    month: "short",
  })

  const year = new Date(input).getFullYear()
  return `${month} ${year}`
}
---

<PageLayout title={ABOUT.TITLE} description={ABOUT.DESCRIPTION}>
  <TopLayout>
    <div class="animate page-heading">
      {ABOUT.TITLE}
    </div>
  </TopLayout>
  <BottomLayout>
    <!-- Visual Representations Section -->
    <section class="animate">
      <div class="space-y-4">
        <h2 class="text-2xl font-semibold text-black dark:text-white mb-4">
          Visual Representations
        </h2>
        <p class="text-black/75 dark:text-white/75 mb-8">
          A visual journey through different representations of myself - from digital avatar to artistic interpretation.
        </p>
        <ImageCompare
          beforeSrc="/images/yasafVolDnD.png"
          afterSrc="/images/yasafVolDrawn.png"
          alt="Yasaf - D&D character vs drawn version"
          width={500}
          labelText="Drag slider to compare my D&D character vs drawn version"
        />
      </div>
    </section>

    <!-- About Content -->
    <section class="animate mt-12">
      <article class="prose prose-lg max-w-none dark:prose-invert">
        <AboutContent />
      </article>
    </section>

    <!-- Work Experience Section -->
    <section class="animate mt-12">
      <div class="space-y-4">
        <h2 class="text-2xl font-semibold text-black dark:text-white mb-4">
          Professional Journey
        </h2>
        <p class="text-black/75 dark:text-white/75">
          My career progression and professional experience.
        </p>
      </div>
    </section>

    <!-- Work Timeline -->
    <ul>
      {
        workItems.map((entry) => (
          <li class="animate border-b border-black/10 dark:border-white/25 mt-4 py-8 first-of-type:mt-0 first-of-type:pt-0 last-of-type:border-none">
            <div class="text-sm uppercase mb-4">
              {formatWorkDate(entry.data.dateStart)} - {formatWorkDate(entry.data.dateEnd)}
            </div>
            <div class="text-black dark:text-white font-semibold">
              {entry.data.company}
            </div>
            <div class="text-sm font-semibold">
              {entry.data.role}
            </div>
            <article class="prose dark:prose-invert mt-4">
              <entry.Content />
            </article>
          </li>
        ))
      }
    </ul>
  </BottomLayout>
</PageLayout>

<style>
  .prose {
    @apply text-black dark:text-white leading-relaxed;
  }

  .prose h2 {
    @apply text-xl font-semibold mt-6 mb-3;
  }

  .prose p {
    @apply mb-4;
  }

  .prose strong {
    @apply font-semibold;
  }

  .prose em {
    @apply italic;
  }

  .prose blockquote {
    @apply border-l-4 border-black/25 dark:border-white/25 pl-4 italic my-4;
  }
</style>
